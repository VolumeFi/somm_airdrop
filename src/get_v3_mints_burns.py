from pprint import pprint
from web3 import Web3
from decoding_utils import decode_log
import json
import pandas as pd
from tqdm import tqdm
from etherscan_connector import EtherscanApiConnector

api_rate_limit_message = "Max rate limit reached"

# Etherscan Logs:
# https://docs.etherscan.io/api-endpoints/logs

# ======================================================================================================================


SOMM_V3_CONTRACTS = [
    {
        "name": "Release1 Add",
        "address": "0x8039722EE74dE2e37fDc39783b0a574Ea492DBAc",
        "abi": [{"name": "AddedLiquidity", "inputs": [{"name": "tokenId", "type": "uint256", "indexed": True}, {"name": "token0", "type": "address", "indexed": True}, {"name": "token1", "type": "address", "indexed": True}, {"name": "liquidity", "type": "uint256", "indexed": False}, {"name": "amount0", "type": "uint256", "indexed": False}, {"name": "amount1", "type": "uint256", "indexed": False}], "anonymous": False, "type": "event"}, {"name": "NFLPModified", "inputs": [{"name": "oldTokenId", "type": "uint256", "indexed": True}, {"name": "newTokenId", "type": "uint256", "indexed": True}], "anonymous": False, "type": "event"}, {"name": "Paused", "inputs": [{"name": "paused", "type": "bool", "indexed": False}], "anonymous": False, "type": "event"}, {"stateMutability": "nonpayable", "type": "constructor", "inputs": [], "outputs":[]}, {"stateMutability": "payable", "type": "function", "name": "addLiquidityEthForUniV3", "inputs": [{"name": "_tokenId", "type": "uint256"}, {"name": "uniV3Params", "type": "tuple", "components": [{"name": "token0", "type": "address"}, {"name": "token1", "type": "address"}, {"name": "fee", "type": "uint256"}, {"name": "tickLower", "type": "int128"}, {"name": "tickUpper", "type": "int128"}, {"name": "amount0Desired", "type": "uint256"}, {"name": "amount1Desired", "type": "uint256"}, {"name": "amount0Min", "type": "uint256"}, {"name": "amount1Min", "type": "uint256"}, {"name": "recipient", "type": "address"}, {"name": "deadline", "type": "uint256"}]}], "outputs": [], "gas":963921}, {"stateMutability": "nonpayable", "type": "function", "name": "addLiquidityForUniV3", "inputs": [{"name": "_tokenId", "type": "uint256"}, {"name": "uniV3Params", "type": "tuple", "components": [{"name": "token0", "type": "address"}, {"name": "token1", "type": "address"}, {"name": "fee", "type": "uint256"}, {"name": "tickLower", "type": "int128"}, {"name": "tickUpper", "type": "int128"}, {"name": "amount0Desired", "type": "uint256"}, {"name": "amount1Desired", "type": "uint256"}, {"name": "amount0Min", "type": "uint256"}, {"name": "amount1Min", "type": "uint256"}, {"name": "recipient", "type": "address"}, {"name": "deadline", "type": "uint256"}]}], "outputs": [], "gas":867874}, {"stateMutability": "nonpayable", "type": "function", "name": "modifyPositionForUniV3NFLP", "inputs": [{"name": "_tokenId", "type": "uint256"}, {"name": "modifyParams", "type": "tuple", "components": [{"name": "fee", "type": "uint256"}, {"name": "tickLower", "type": "int128"}, {"name": "tickUpper", "type": "int128"}, {"name": "recipient", "type": "address"}, {"name": "deadline", "type": "uint256"}]}], "outputs": [], "gas":547339}, {"stateMutability": "nonpayable", "type": "function", "name": "pause", "inputs": [{"name": "_paused", "type": "bool"}], "outputs": [], "gas":39101}, {"stateMutability": "nonpayable", "type": "function", "name": "newAdmin", "inputs": [{"name": "_admin", "type": "address"}], "outputs": [], "gas":37784}, {"stateMutability": "nonpayable", "type": "function", "name": "newFeeAddress", "inputs": [{"name": "_feeAddress", "type": "address"}], "outputs": [], "gas":37814}, {"stateMutability": "nonpayable", "type": "function", "name": "batchWithdraw", "inputs": [{"name": "token", "type": "address[8]"}, {"name": "amount", "type": "uint256[8]"}, {"name": "to", "type": "address[8]"}], "outputs": [], "gas":352127}, {"stateMutability": "nonpayable", "type": "function", "name": "withdraw", "inputs": [{"name": "token", "type": "address"}, {"name": "amount", "type": "uint256"}, {"name": "to", "type": "address"}], "outputs": [], "gas":96427}, {"stateMutability": "payable", "type": "fallback"}, {"stateMutability": "view", "type": "function", "name": "paused", "inputs": [], "outputs":[{"name": "", "type": "bool"}], "gas": 2718}, {"stateMutability": "view", "type": "function", "name": "admin", "inputs": [], "outputs":[{"name": "", "type": "address"}], "gas": 2748}, {"stateMutability": "view", "type": "function", "name": "feeAddress", "inputs": [], "outputs":[{"name": "", "type": "address"}], "gas": 2778}],
        "topic0": "0x8608f0d1a9f263ba6515609d93d7510949b8477690ce655f3b813420049d3d84"
    },
    {
        "name": "Release1 Swapv2Addv3",
        "address": "0xDA76A489b8148Ba6e409B04259CB14E75e5E9dd3",
        "abi": [{"name":"AddedLiquidity","inputs":[{"name":"tokenId","type":"uint256","indexed":True},{"name":"token0","type":"address","indexed":True},{"name":"token1","type":"address","indexed":True},{"name":"liquidity","type":"uint256","indexed":False},{"name":"amount0","type":"uint256","indexed":False},{"name":"amount1","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"name":"NFLPModified","inputs":[{"name":"oldTokenId","type":"uint256","indexed":True},{"name":"newTokenId","type":"uint256","indexed":True}],"anonymous":False,"type":"event"},{"name":"Paused","inputs":[{"name":"paused","type":"bool","indexed":False}],"anonymous":False,"type":"event"},{"name":"FeeChanged","inputs":[{"name":"newFee","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"stateMutability":"nonpayable","type":"constructor","inputs":[],"outputs":[]},{"stateMutability":"payable","type":"function","name":"addLiquidityEthForUniV3","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"amount0Desired","type":"uint256"},{"name":"amount1Desired","type":"uint256"},{"name":"amount0Min","type":"uint256"},{"name":"amount1Min","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":314603},{"stateMutability":"nonpayable","type":"function","name":"addLiquidityForUniV3","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"amount0Desired","type":"uint256"},{"name":"amount1Desired","type":"uint256"},{"name":"amount0Min","type":"uint256"},{"name":"amount1Min","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":218568},{"stateMutability":"payable","type":"function","name":"modifyPositionForUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"modifyParams","type":"tuple","components":[{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":623761},{"stateMutability":"payable","type":"function","name":"investTokenForUniPair","inputs":[{"name":"_token","type":"address"},{"name":"amount","type":"uint256"},{"name":"_tokenId","type":"uint256"},{"name":"_uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"liquidityMin","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":869301},{"stateMutability":"nonpayable","type":"function","name":"pause","inputs":[{"name":"_paused","type":"bool"}],"outputs":[],"gas":39131},{"stateMutability":"nonpayable","type":"function","name":"newAdmin","inputs":[{"name":"_admin","type":"address"}],"outputs":[],"gas":37814},{"stateMutability":"nonpayable","type":"function","name":"newFeeAmount","inputs":[{"name":"_feeAmount","type":"uint256"}],"outputs":[],"gas":39091},{"stateMutability":"nonpayable","type":"function","name":"newFeeAddress","inputs":[{"name":"_feeAddress","type":"address"}],"outputs":[],"gas":37874},{"stateMutability":"nonpayable","type":"function","name":"batchWithdraw","inputs":[{"name":"token","type":"address[8]"},{"name":"amount","type":"uint256[8]"},{"name":"to","type":"address[8]"}],"outputs":[],"gas":352187},{"stateMutability":"nonpayable","type":"function","name":"withdraw","inputs":[{"name":"token","type":"address"},{"name":"amount","type":"uint256"},{"name":"to","type":"address"}],"outputs":[],"gas":96487},{"stateMutability":"payable","type":"fallback"},{"stateMutability":"view","type":"function","name":"paused","inputs":[],"outputs":[{"name":"","type":"bool"}],"gas":2778},{"stateMutability":"view","type":"function","name":"admin","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2808},{"stateMutability":"view","type":"function","name":"feeAddress","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2838},{"stateMutability":"view","type":"function","name":"feeAmount","inputs":[],"outputs":[{"name":"","type":"uint256"}],"gas":2868}],
        "topic0": "0x8608f0d1a9f263ba6515609d93d7510949b8477690ce655f3b813420049d3d84"
    },
    {
        "name": "Release2 Swapv2Addv3",
        "address": "0xE76427463FdBacdD0e794e5Ea30269f30Dd9B8eB",
        "abi": [{"name":"AddedLiquidity","inputs":[{"name":"tokenId","type":"uint256","indexed":True},{"name":"token0","type":"address","indexed":True},{"name":"token1","type":"address","indexed":True},{"name":"liquidity","type":"uint256","indexed":False},{"name":"amount0","type":"uint256","indexed":False},{"name":"amount1","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"name":"NFLPModified","inputs":[{"name":"oldTokenId","type":"uint256","indexed":True},{"name":"newTokenId","type":"uint256","indexed":True}],"anonymous":False,"type":"event"},{"name":"Paused","inputs":[{"name":"paused","type":"bool","indexed":False}],"anonymous":False,"type":"event"},{"name":"FeeChanged","inputs":[{"name":"newFee","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"stateMutability":"nonpayable","type":"constructor","inputs":[],"outputs":[]},{"stateMutability":"payable","type":"function","name":"addLiquidityEthForUniV3","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"amount0Desired","type":"uint256"},{"name":"amount1Desired","type":"uint256"},{"name":"amount0Min","type":"uint256"},{"name":"amount1Min","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":314603},{"stateMutability":"nonpayable","type":"function","name":"addLiquidityForUniV3","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"amount0Desired","type":"uint256"},{"name":"amount1Desired","type":"uint256"},{"name":"amount0Min","type":"uint256"},{"name":"amount1Min","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":218568},{"stateMutability":"payable","type":"function","name":"modifyPositionForUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"modifyParams","type":"tuple","components":[{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":623761},{"stateMutability":"payable","type":"function","name":"investTokenForUniPair","inputs":[{"name":"_token","type":"address"},{"name":"amount","type":"uint256"},{"name":"_tokenId","type":"uint256"},{"name":"_uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"sqrtPriceAX96","type":"uint256"},{"name":"sqrtPriceBX96","type":"uint256"},{"name":"liquidityMin","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":850715},{"stateMutability":"nonpayable","type":"function","name":"pause","inputs":[{"name":"_paused","type":"bool"}],"outputs":[],"gas":39131},{"stateMutability":"nonpayable","type":"function","name":"newAdmin","inputs":[{"name":"_admin","type":"address"}],"outputs":[],"gas":37814},{"stateMutability":"nonpayable","type":"function","name":"newFeeAmount","inputs":[{"name":"_feeAmount","type":"uint256"}],"outputs":[],"gas":39091},{"stateMutability":"nonpayable","type":"function","name":"newFeeAddress","inputs":[{"name":"_feeAddress","type":"address"}],"outputs":[],"gas":37874},{"stateMutability":"nonpayable","type":"function","name":"batchWithdraw","inputs":[{"name":"token","type":"address[8]"},{"name":"amount","type":"uint256[8]"},{"name":"to","type":"address[8]"}],"outputs":[],"gas":352187},{"stateMutability":"nonpayable","type":"function","name":"withdraw","inputs":[{"name":"token","type":"address"},{"name":"amount","type":"uint256"},{"name":"to","type":"address"}],"outputs":[],"gas":96487},{"stateMutability":"payable","type":"fallback"},{"stateMutability":"view","type":"function","name":"paused","inputs":[],"outputs":[{"name":"","type":"bool"}],"gas":2778},{"stateMutability":"view","type":"function","name":"admin","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2808},{"stateMutability":"view","type":"function","name":"feeAddress","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2838},{"stateMutability":"view","type":"function","name":"feeAmount","inputs":[],"outputs":[{"name":"","type":"uint256"}],"gas":2868}],
        "topic0": "0x8608f0d1a9f263ba6515609d93d7510949b8477690ce655f3b813420049d3d84"
    },
    {
        "name": "Release3 Swapv2Addv3",
        "address": "0x5e6906203B985C22B39824Ae2A8488d7dF275f28",
        "abi": [{"name":"AddedLiquidity","inputs":[{"name":"tokenId","type":"uint256","indexed":True},{"name":"token0","type":"address","indexed":True},{"name":"token1","type":"address","indexed":True},{"name":"liquidity","type":"uint256","indexed":False},{"name":"amount0","type":"uint256","indexed":False},{"name":"amount1","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"name":"NFLPModified","inputs":[{"name":"oldTokenId","type":"uint256","indexed":True},{"name":"newTokenId","type":"uint256","indexed":True}],"anonymous":False,"type":"event"},{"name":"Paused","inputs":[{"name":"paused","type":"bool","indexed":False}],"anonymous":False,"type":"event"},{"name":"FeeChanged","inputs":[{"name":"newFee","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"stateMutability":"nonpayable","type":"constructor","inputs":[],"outputs":[]},{"stateMutability":"payable","type":"function","name":"addLiquidityEthForUniV3","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"amount0Desired","type":"uint256"},{"name":"amount1Desired","type":"uint256"},{"name":"amount0Min","type":"uint256"},{"name":"amount1Min","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":314603},{"stateMutability":"nonpayable","type":"function","name":"addLiquidityForUniV3","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"amount0Desired","type":"uint256"},{"name":"amount1Desired","type":"uint256"},{"name":"amount0Min","type":"uint256"},{"name":"amount1Min","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":218568},{"stateMutability":"payable","type":"function","name":"modifyPositionForUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"modifyParams","type":"tuple","components":[{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":618801},{"stateMutability":"payable","type":"function","name":"investTokenForUniPair","inputs":[{"name":"_token","type":"address"},{"name":"amount","type":"uint256"},{"name":"_tokenId","type":"uint256"},{"name":"_uniV3Params","type":"tuple","components":[{"name":"token0","type":"address"},{"name":"token1","type":"address"},{"name":"fee","type":"uint256"},{"name":"tickLower","type":"int128"},{"name":"tickUpper","type":"int128"},{"name":"sqrtPriceAX96","type":"uint256"},{"name":"sqrtPriceBX96","type":"uint256"},{"name":"liquidityMin","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[],"gas":850715},{"stateMutability":"nonpayable","type":"function","name":"pause","inputs":[{"name":"_paused","type":"bool"}],"outputs":[],"gas":39131},{"stateMutability":"nonpayable","type":"function","name":"newAdmin","inputs":[{"name":"_admin","type":"address"}],"outputs":[],"gas":37814},{"stateMutability":"nonpayable","type":"function","name":"newFeeAmount","inputs":[{"name":"_feeAmount","type":"uint256"}],"outputs":[],"gas":39091},{"stateMutability":"nonpayable","type":"function","name":"newFeeAddress","inputs":[{"name":"_feeAddress","type":"address"}],"outputs":[],"gas":37874},{"stateMutability":"nonpayable","type":"function","name":"batchWithdraw","inputs":[{"name":"token","type":"address[8]"},{"name":"amount","type":"uint256[8]"},{"name":"to","type":"address[8]"}],"outputs":[],"gas":352187},{"stateMutability":"nonpayable","type":"function","name":"withdraw","inputs":[{"name":"token","type":"address"},{"name":"amount","type":"uint256"},{"name":"to","type":"address"}],"outputs":[],"gas":96487},{"stateMutability":"payable","type":"fallback"},{"stateMutability":"view","type":"function","name":"paused","inputs":[],"outputs":[{"name":"","type":"bool"}],"gas":2778},{"stateMutability":"view","type":"function","name":"admin","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2808},{"stateMutability":"view","type":"function","name":"feeAddress","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2838},{"stateMutability":"view","type":"function","name":"feeAmount","inputs":[],"outputs":[{"name":"","type":"uint256"}],"gas":2868}],
        "topic0": "0x8608f0d1a9f263ba6515609d93d7510949b8477690ce655f3b813420049d3d84"
    },
    {
        "name": "Release1 v3Remove",
        "address": "0x66C7fAFe42cC9B1aba0cc979F216B3bbF80ff23B",
        "abi": [{"name":"RemovedLiquidity","inputs":[{"name":"tokenId","type":"uint256","indexed":True},{"name":"token0","type":"address","indexed":True},{"name":"token1","type":"address","indexed":True},{"name":"liquidity","type":"uint256","indexed":False},{"name":"amount0","type":"uint256","indexed":False},{"name":"amount1","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"name":"Paused","inputs":[{"name":"paused","type":"bool","indexed":False}],"anonymous":False,"type":"event"},{"name":"FeeChanged","inputs":[{"name":"newFee","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"stateMutability":"nonpayable","type":"constructor","inputs":[],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"isBurn","type":"bool"}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityEthFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityEthFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"isBurn","type":"bool"}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"divestUniV3NFLPToToken","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_token","type":"address"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"minTokenAmount","type":"uint256"}],"outputs":[{"name":"","type":"uint256"}]},{"stateMutability":"payable","type":"function","name":"divestUniV3NFLPToToken","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_token","type":"address"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"minTokenAmount","type":"uint256"},{"name":"isBurn","type":"bool"}],"outputs":[{"name":"","type":"uint256"}]},{"stateMutability":"payable","type":"function","name":"divestUniV3NFLPToToken","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_token","type":"address"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"minTokenAmount","type":"uint256"},{"name":"isBurn","type":"bool"},{"name":"deadline","type":"uint256"}],"outputs":[{"name":"","type":"uint256"}]},{"stateMutability":"nonpayable","type":"function","name":"pause","inputs":[{"name":"_paused","type":"bool"}],"outputs":[],"gas":39101},{"stateMutability":"nonpayable","type":"function","name":"newAdmin","inputs":[{"name":"_admin","type":"address"}],"outputs":[],"gas":37784},{"stateMutability":"nonpayable","type":"function","name":"newFeeAmount","inputs":[{"name":"_feeAmount","type":"uint256"}],"outputs":[],"gas":39061},{"stateMutability":"nonpayable","type":"function","name":"newFeeAddress","inputs":[{"name":"_feeAddress","type":"address"}],"outputs":[],"gas":37844},{"stateMutability":"nonpayable","type":"function","name":"batchWithdraw","inputs":[{"name":"token","type":"address[8]"},{"name":"amount","type":"uint256[8]"},{"name":"to","type":"address[8]"}],"outputs":[],"gas":352157},{"stateMutability":"nonpayable","type":"function","name":"withdraw","inputs":[{"name":"token","type":"address"},{"name":"amount","type":"uint256"},{"name":"to","type":"address"}],"outputs":[],"gas":96457},{"stateMutability":"payable","type":"fallback"},{"stateMutability":"view","type":"function","name":"paused","inputs":[],"outputs":[{"name":"","type":"bool"}],"gas":2748},{"stateMutability":"view","type":"function","name":"admin","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2778},{"stateMutability":"view","type":"function","name":"feeAddress","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2808},{"stateMutability":"view","type":"function","name":"feeAmount","inputs":[],"outputs":[{"name":"","type":"uint256"}],"gas":2838}],
        "topic0": "0x24345136764733eb66b7482a1178ace3dc025c4dd07e4abacdc7e1b445e70751"
    },
    {
        "name": "Release2 v3Remove",
        "address": "0x356Ab692955cC3cBa5de3E9bA4b0390c39353DFD",
        "abi": [{"name":"RemovedLiquidity","inputs":[{"name":"tokenId","type":"uint256","indexed":True},{"name":"token0","type":"address","indexed":True},{"name":"token1","type":"address","indexed":True},{"name":"liquidity","type":"uint256","indexed":False},{"name":"amount0","type":"uint256","indexed":False},{"name":"amount1","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"name":"Paused","inputs":[{"name":"paused","type":"bool","indexed":False}],"anonymous":False,"type":"event"},{"name":"FeeChanged","inputs":[{"name":"newFee","type":"uint256","indexed":False}],"anonymous":False,"type":"event"},{"stateMutability":"nonpayable","type":"constructor","inputs":[],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"isBurn","type":"bool"}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityEthFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"removeLiquidityEthFromUniV3NFLP","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"isBurn","type":"bool"}],"outputs":[]},{"stateMutability":"payable","type":"function","name":"divestUniV3NFLPToToken","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_token","type":"address"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"minTokenAmount","type":"uint256"}],"outputs":[{"name":"","type":"uint256"}]},{"stateMutability":"payable","type":"function","name":"divestUniV3NFLPToToken","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_token","type":"address"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"minTokenAmount","type":"uint256"},{"name":"isBurn","type":"bool"}],"outputs":[{"name":"","type":"uint256"}]},{"stateMutability":"payable","type":"function","name":"divestUniV3NFLPToToken","inputs":[{"name":"_tokenId","type":"uint256"},{"name":"_token","type":"address"},{"name":"_removeParams","type":"tuple","components":[{"name":"liquidity","type":"uint256"},{"name":"recipient","type":"address"},{"name":"deadline","type":"uint256"}]},{"name":"minTokenAmount","type":"uint256"},{"name":"isBurn","type":"bool"},{"name":"deadline","type":"uint256"}],"outputs":[{"name":"","type":"uint256"}]},{"stateMutability":"nonpayable","type":"function","name":"pause","inputs":[{"name":"_paused","type":"bool"}],"outputs":[],"gas":39101},{"stateMutability":"nonpayable","type":"function","name":"newAdmin","inputs":[{"name":"_admin","type":"address"}],"outputs":[],"gas":37784},{"stateMutability":"nonpayable","type":"function","name":"newFeeAmount","inputs":[{"name":"_feeAmount","type":"uint256"}],"outputs":[],"gas":39061},{"stateMutability":"nonpayable","type":"function","name":"newFeeAddress","inputs":[{"name":"_feeAddress","type":"address"}],"outputs":[],"gas":37844},{"stateMutability":"nonpayable","type":"function","name":"batchWithdraw","inputs":[{"name":"token","type":"address[8]"},{"name":"amount","type":"uint256[8]"},{"name":"to","type":"address[8]"}],"outputs":[],"gas":352157},{"stateMutability":"nonpayable","type":"function","name":"withdraw","inputs":[{"name":"token","type":"address"},{"name":"amount","type":"uint256"},{"name":"to","type":"address"}],"outputs":[],"gas":96457},{"stateMutability":"payable","type":"fallback"},{"stateMutability":"view","type":"function","name":"paused","inputs":[],"outputs":[{"name":"","type":"bool"}],"gas":2748},{"stateMutability":"view","type":"function","name":"admin","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2778},{"stateMutability":"view","type":"function","name":"feeAddress","inputs":[],"outputs":[{"name":"","type":"address"}],"gas":2808},{"stateMutability":"view","type":"function","name":"feeAmount","inputs":[],"outputs":[{"name":"","type":"uint256"}],"gas":2838}],
        "topic0": "0x24345136764733eb66b7482a1178ace3dc025c4dd07e4abacdc7e1b445e70751"
    }
]



if __name__ == "__main__":
    etherscan_conn = EtherscanApiConnector()

    mints_burns_dict = []
    
    for somm_contract_dict in SOMM_V3_CONTRACTS:
        contract_events = etherscan_conn.get_event_log(
            address=somm_contract_dict["address"], topic0=somm_contract_dict["topic0"])
        
        for event in tqdm(contract_events):
            decoded_event = decode_log(
                event['data'], topics=event['topics'], abi=somm_contract_dict["abi"])


            event_dict = json.loads(decoded_event[1])
            # event_dict keys: [token0, token1, liquidity, amount0, amount1, somm_user_address]

            if decoded_event[0] == "RemovedLiquidity":
                event_dict['liquidity'] *= -1
            
            event_tx_receipt = etherscan_conn.get_tx_receipt(
                transaction_string=event['transactionHash'])
            event_dict['somm_user_address'] = event_tx_receipt['from']
            
            mints_burns_dict.append(event_dict)
            breakpoint()

    # mints_burns_df = pd.DataFrame(mints_burns_dict)
    # unique_somm_users = mints_burns_df['somm_user_address'].unique().tolist()
    # mints_burns_df.to_csv("somm_mints_burns.csv")
    # pd.Series(mints_burns_df['somm_user_address'].unique()).to_csv("somm_user_addresses.csv")

    breakpoint()